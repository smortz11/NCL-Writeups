# Log Analysis Techniques Walkthrough
In this challenge, we are given another file where we are testing our CLI ninja abilities. Please refer back to [[Login (Easy) AS]] for some basic CLI tools that we can use to navigate the log easier. Go ahead and download

---
# Q1 - 5 Points
#### What IP address did "ftpuser" first log in from?

```bash
cat vsftpd.log | grep "ftpuser" | grep -i "login"
```

This command does the following:
1. cat vsftpd.log -> outputs the contents of the file
2. grep "ftpuser" -> only outputs lines that contain the username
3. grep -i "login" -> looks for lines that contain "login", but case-insensitive

How did I know to search for login? I didn't! Just look through the log until you find a pattern that will match what you need and give you the 100% correct answer.
#### Answer:
`10.0.0.123`

---
# Q2 - 5 Points
#### What is the first directory that ftpuser created?

```bash
cat vsftpd.log | grep -i "dir" | head
```

This command does the following:
1. cat vsftpd.log -> outputs the contents of the log
2. grep -i "dir" -> case-insensitive search for `dir`
3. head -> returns only the first ten lines

Again, I did not know to search for "dir", or "mkdir" more specifically. Instead, I started with "directory" with no results.

The top line (the first instance) we see contains `/home/ftpuser/TreeSizeFree`

The directory is the last folder in that sequence
#### Answer:
`TreeSizeFree`

---
# Q3 - 5 Points
#### What is the last directory that ftpuser created?

```bash
cat vsftpd.log | grep -i "mkdir" | grep -i "ftpuser" | tail
```

This command does the following:
1. cat vsftpd.log -> outputs the contents of the log
2. grep -i "mkdir" -> case-insensitive search for `mkdir`
3. grep -i "ftpuser" -> case-insensitive search for `ftpuser`
4. tail -> returns only the last ten lines

From the last question, I knew what fields to search for.

The bottom line we see contains `/home/ftpuser/110D300S`

The directory is the last folder in that sequence
#### Answer:
`110D300S`

---
# Q4 - 10 Points
#### What file extension was the most used by ftpuser?

```bash
cat vsftpd.log | cut -d' ' -f8,13 | grep "[ftpuser]" | cut -d' ' -f2 | grep "\." | cut -d'.' -f2 | sort | uniq -c | sort -n

```

This command does the following:
1. cat vsftpd.log -> outputs the contents of the log
2. cut -d' ' -f8,13 -> creates columns that are separated by spaces. We then select the 8th and 13th column, representing the user and the file path
3. `grep "[ftpuser]"` -> selects only the lines generated by this user 
4. cut -d' ' -f2 -> only selects the path now (we know all of these were created by ftpuser from the previous command)
5. `grep "\."` only returns paths that contain a dot, suggesting a file extension
6. cut -d'.' -f2 -> returns the portion of the paths after the dot
7. sort | uniq -c | sort -n -> sorts the list with unique counts

You will not be able to type this all at once and understand it. We *incrementally* create these commands. We can test each iteration of our command to verify it does what we need.
#### Answer:
`JPG`

---
# Q5 - 10 Points
#### What is the username of the other user in this log?

```bash
cat vsftpd.log | grep -v "ftpuser"
```

This command does the following:
1. cat vsftpd.log -> outputs the contents of the log
2. grep -v "ftpuser" -> invert search, returns lines that do *not* contain `ftpuser`
#### Answer:
`jimmy`

---
# Q6 - 10 Points
#### What IP address did this other user log in from?

We can see this next to to the above question.
#### Answer:
`10.0.0.214`

---
# Q7 - 10 Points
#### How many total bytes did this other user upload?

```bash
cat vsftpd.log | grep "jimmy" | grep -i "upload"| cut -d',' -f3 | cut -d' ' -f2 | awk '{sum+=$1} END {print sum}'
```

1. cat vsftpd.log -> output the contents of the file
2. grep "jimmy" -> finds only lines with the username
3. grep -i "upload" -> finds lines where the user has uploaded something
4. cut -d',' -f3 -> delimits by `,` and selects the third field (the byte value)
5. cut -d' ' -f2 -> selects the bytes value
6. awk '{sum+=$1} END {print sum}' -> runs a script to sum the column of numbers
#### Answer:
`105750628`

---
# Q8 - 10 Points
#### How many total bytes did ftpuser upload?

```bash
cat vsftpd.log | grep "ftpuser" | grep -i "upload"| cut -d',' -f3 | cut -d' ' -f2 | awk '{sum+=$1} END {print sum}'
```

1. cat vsftpd.log -> output the contents of the file
2. grep "ftpuser" -> finds only lines with the username
3. grep -i "upload" -> finds lines where the user has uploaded something
4. cut -d',' -f3 -> delimits by `,` and selects the third field (the byte value)
5. cut -d' ' -f2 -> selects the bytes value
6. awk '{sum+=$1} END {print sum}' -> runs a script to sum the column of numbers
#### Answer:
`13980839165`

---
# Q9 - 10 Points
#### How many total bytes did ftpuser download?

```bash
cat vsftpd.log | grep "ftpuser" | grep -i "download"| cut -d',' -f3 | cut -d' ' -f2 | awk '{sum+=$1} END {print sum}'
```

1. cat vsftpd.log -> output the contents of the file
2. grep "ftpuser" -> finds only lines with the username
3. grep -i "download" -> finds lines where the user has uploaded something
4. cut -d',' -f3 -> delimits by `,` and selects the third field (the byte value)
5. cut -d' ' -f2 -> selects the bytes value
6. awk '{sum+=$1} END {print sum}' -> runs a script to sum the column of numbers
#### Answer:
`6008032`

---
# Q10 - 25 Points
#### Identify the IP address of the suspicious login (the login with no subsequent activity)

```bash
cat vsftpd.log | cut -d' ' -f12 | cut -d'"' -f2 | sort -n | uniq -c | sort -n
```

1. cat vsftpd.log -> output the contents of the file
2. cut -d' ' -f12 -> Selects the field with the IP
3. cut -d'"' -f2 -> sanitizes the IP to not include the quotation marks
4. sort -n | uniq -c | sort -n -> sorts and compresses the output

We see the following:
```bash
      1 10.3.0.6
     20 10.0.0.214
     40 
   2652 10.0.0.123
```
#### Answer:
`10.3.0.6`

---
# Conclusion

When analyzing logs in this manner, it is not important to memorize file formats. We can look at the log and tailor our commands accordingly.